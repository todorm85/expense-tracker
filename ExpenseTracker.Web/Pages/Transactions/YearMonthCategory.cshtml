@page
@model ExpenseTracker.Web.Pages.Transactions.YearMonthCategoryModel

<div class="text-center">
    <form method="post">
        <h5 class="row justify-content-center mt-1">
            <span class="text-center d-inline-block">
                <span class="d-inline-block w-100">Expense</span>
                <span class="badge">@Model.TotalExpense.ToString("N0") / @Model.AverageExpense.ToString("N0")</span>
            </span>
            <span class="text-center d-inline-block">
                <span class="d-inline-block w-100">Income</span>
                <span class="badge">@Model.TotalIncome.ToString("N0") / @Model.AverageIncome.ToString("N0")</span>
            </span>
            @{ var avgBalClass = (Model.AverageBalance >= 0) ? "success" : "danger"; }
            <span class="d-inline-block text-center">
                <span class="d-inline-block w-100">Balance</span>
                <span class="badge badge-@avgBalClass">@Model.Balance.ToString("N0") / @Model.AverageBalance.ToString("N0")</span>
            </span>
            <span class="d-inline-block text-center">
                <span class="d-inline-block w-100"></span>
                <span>(total / month avg)</span>
            </span>
        </h5>
        <partial name="_Filters" for="Filters" />
        @if (Model.ExpandableMonths.Count > 0)
        {
            <div class="text-left border rounded mb-3">
                <div class="d-inline-block p-2 m-1 bg-light border rounded">
                    <span class="badge badge-secondary font-italic mr-1">category</span>
                    <span class="font-italic">total</span> |
                    <span class="text-secondary font-italic">month avg</span>
                </div>
                @foreach (var catAvg in Model.AverageAndTotalsForCategory.OrderByDescending(x => x.Value[1]))
                {
                    var catBalClass = (catAvg.Value[1] > 0) ? "success" : "danger";
                    var catBalAvgClass = (catAvg.Value[0] > 0) ? "success" : "danger";

                    <div class="d-inline-block p-2 m-1 bg-light border rounded">
                        <span class="badge badge-secondary mr-1">@(string.IsNullOrEmpty(catAvg.Key) ? "Unspecified" : catAvg.Key)</span>
                        <span>@catAvg.Value[1].ToString("N0")</span> |
                        <span class="text-secondary">@catAvg.Value[0].ToString("N0")</span>
                    </div>
                }
            </div>

            @for (int mi = 0; mi < Model.ExpandableMonths.Count; mi++)
            {
                <partial name="_ExpandableMonth" model="@Model.ExpandableMonths[mi]" />
            }
        }
        else
        {
            <div class="alert-warning alert">No transactions found.</div>
        }
    </form>
</div>